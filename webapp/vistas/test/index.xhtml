<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/layouts/template.xhtml">

    <ui:define name="content">
        <b:container fluid="true">
<!--            6-->
            <b:panel title="Citas" largeScreen="8" collapsible="false">
                <b:container styleClass="panel-body" fluid="true">
                    <legend>Citas <b:iconAwesome name="info" onclick="showModalWellcome()"></b:iconAwesome> </legend>
                    <b:form id="form">
                        <b:row>
                            <b:column mediumScreen="9" smallScreen="12"></b:column>
                            <b:column mediumScreen="1" smallScreen="12">
                                <b:commandButton value="Nueva cita"
                                                 action="#{citabean.renderDataAlumno(auth.strNombreUsuarioLogin, auth.strUsuario)}"
                                                 title="Nueva cita"
                                                 ajax="true"
                                                 update=":form:contenido"
                                                 styleClass="btn btn-default">
                                </b:commandButton>
                            </b:column>
                            <b:column mediumScreen="1" smallScreen="12" >
                                <b:commandButton title="Buscar Citas"
                                                 value="Buscar Cita"
                                                 action="#{misictas.UpdateValores(auth.strNombreUsuarioLogin,auth.strUsuario)}"
                                                 ajax="true"
                                                 update="@form"
                                                 styleClass="btn btn-default">
                                </b:commandButton>
                            </b:column>
                        </b:row>
                        <b:container style="margin-top:25px"></b:container>
                        <b:row>
                            <b:container>
                                <b:navCommandLink href="index.uat" value="Reinicar formulario"  iconAwesome="refresh" iconAlign="right"></b:navCommandLink>
                            </b:container>
                        </b:row>
                        <b:container style="margin-top:25px"></b:container>

                        <!-- IMPLEMENTACION PARA UNA MOSTRAR CITAS -->
                        <b:row id="miscitas" rendered="#{misictas.renderMisCitas}">
                            <b:container >
                                <legend>
                                    Mis Citas
                                </legend>
                                <b:container>
                                    <b:row>
                                        <b:column largeScreen="10" mediumScreen="10" smallScreen="10">
                                            <b:dataTable value="#{misictas.listMisCitas}" var="item">
                                                <b:dataTableColumn value="#{item.strIdCita}" label="ID"></b:dataTableColumn>
                                                <b:dataTableColumn value="#{item.strDescripcionCita}" label="Datos Cita"></b:dataTableColumn>
                                                <b:dataTableColumn value="#{item.area}" label="Area"></b:dataTableColumn>
                                                <b:dataTableColumn value="#{item.tramite}" label="Tramite"></b:dataTableColumn>
                                                <b:dataTableColumn value="#{item.strRepuesta}" label="Retroalimentación"></b:dataTableColumn>
                                                <b:dataTableColumn value="#{item.strFechaHoraReservada}" label="Fecha y Hora"></b:dataTableColumn>
                                                <b:dataTableColumn  value="#{item.strEstatus}" label="Estatus"></b:dataTableColumn>
                                                <b:dataTableColumn label="Cancelar" rendered="#{misictas.isCancelable(item.strEstatus)}" >
                                                    <b:commandButton icon="pencil" iconSize="1x" styleClass="btn btn-default" onclick="$('.modalCancelar').modal()" action="#{misictas.SetModalCancelar(item.area,item.tramite)}"></b:commandButton>
                                                    <h:inputHidden value="#{misictas.localTramite}" id="tramite"></h:inputHidden>
                                                </b:dataTableColumn>
                                            </b:dataTable>
                                        </b:column>
                                    </b:row>
                                </b:container>
                            </b:container>
                        </b:row>
                        <!-- IMPLEMENTACION PARA UNA NUEVA CITA -->
                        <b:row id="contenido">
                            <b:column mediumScreen="6" largeScreen="6" smallScreen="12">
                                <!-- Seccion Izquierda FORMULARIO -->
                                <b:row>
                                    <b:formGroup>
                                        <!--               COMBO DE AREAS             -->
                                        <b:row>
                                            <b:selectOneMenu value="#{citabean.strCurrentArea}"
                                                             colMd="12" colLg="12" colSm="12"
                                                             id="comboAreas"
                                                             label="Seleccione un Area"
                                                             required="true"
                                                             labelColLg="12"
                                                             rendered="#{citabean.hasDataAreas}"
                                                             ajax="true"
                                                             update="@form"
                                                             process="@this">

                                                <f:selectItem itemLabel="Seleccione una area" value="none" itemValue="none"/>
                                                <f:selectItems value="#{citabean.returnAreasList()}"/>

                                                <f:ajax
                                                        event="change"
                                                        execute="@this"
                                                        listener="#{citabean.listenerPostAreas}">
                                                </f:ajax>
                                            </b:selectOneMenu>
                                        </b:row>
                                    </b:formGroup>
                                    <b:formGroup>
                                        <!--               COMBO DE TRAMITES             -->
                                        <b:row>
                                            <b:selectOneMenu value="#{citabean.strCurrentTramite}"
                                                             colMd="12" colLg="12" colSm="12"
                                                             rendered="#{citabean.hasDataTramites}"
                                                             id="selectTramite"
                                                             labelStyle="text-aling:left;"
                                                             label="Seleccione el tramite"
                                                             labelColLg="12"
                                                             ajax="true"
                                                             required="true"
                                                             update="Tramite linkgo"
                                                             process="@this">

                                                <f:selectItem itemLabel="Seleccione un tramite" value="none" itemValue="none"/>
                                                <f:selectItems value="#{citabean.returnTramitesList()}"/>

                                                <f:ajax
                                                        event="change"
                                                        execute="@this"
                                                        listener="#{citabean.listenerPostTramites}">
                                                </f:ajax>
                                            </b:selectOneMenu>
                                        </b:row>
                                    </b:formGroup>
                                    <b:row>
                                        <b:column smallScreen="12" largeScreen="7" mediumScreen="7">
                                            <b:formGroup>
                                                <!--               DATE PICKER FECHAS             -->
                                                <b:dateTimePicker
                                                        id="Fechas"
                                                        weekDaysDisabled="0"
                                                        format="MM/DD/YYYY"
                                                        colMd="12" colLg="12" colSm="12"
                                                        rendered="#{citabean.hasDataTramites}"
                                                        mediumScreen="6" labelMediumScreen="12"
                                                        value="#{citabean.strCurrentCalendar}"
                                                        showTime="false"
                                                        disabledDates="#{citabean.strFechasDisableCalendar}"
                                                        label="Seleccione la fecha de su cita"
                                                        labelColMd="12" labelColLg="12">
                                                </b:dateTimePicker>
                                            </b:formGroup>
                                        </b:column>

                                        <b:column smallScreen="12" largeScreen="4" mediumScreen="4" style="margin-top:18px">
                                           <b:navCommandLink style="color:white !important; text-transform:none;"
                                                   rendered="#{citabean.hasDataTramites}"
                                                   action="#{citabean.ComprobarHorario()}"
                                                   value="Comprobar disponibilidad"
                                                   update="@form"
                                                   styleClass="btn"
                                           ></b:navCommandLink>
                                        </b:column>
                                    </b:row>
                                    <br/>
                                    <br/>
                                    <b:row>
                                        <b:formGroup>
                                            <!--          ComboBox de los horarios                  -->
                                            <b:selectOneMenu value="#{citabean.strCurrentHora}"
                                                             colMd="12" colLg="12" colSm="12"
                                                             rendered="#{citabean.hasDataTramites}"
                                                             id="selectHorarios"
                                                             label="Seleccione el horario de su cita"
                                                             labelColLg="12"
                                                             ajax="true"
                                                             update="combohoras"
                                                             process="@this">

                                                <f:selectItem itemLabel="Seleccione su horario" value="none" itemValue="none"></f:selectItem>
                                                <f:selectItems value="#{citabean.returnHorariosList()}"></f:selectItems>
                                            </b:selectOneMenu>
                                        </b:formGroup>
                                    </b:row>
                                    <b:row>
                                        <b:formGroup>
                                            <b:inputTextarea value="#{citabean.strMotivoCita}"
                                                             colLg="12" colMd="12" colSm="12"
                                                             rendered="#{citabean.hasDataTramites}"
                                                             label="Ingrese el motivo de su cita *"
                                                             ajax="true"
                                            >
                                            </b:inputTextarea>
                                            <h:inputHidden id="idAlumno" value="#{auth.strUsuario}"></h:inputHidden>
                                        </b:formGroup>
                                    </b:row>
                                </b:row>
                            </b:column>
                            <b:column mediumScreen="1" largeScreen="1" smallScreen="12"></b:column>
                            <b:column mediumScreen="5" largeScreen="5" smallScreen="5" rendered="#{citabean.hasDataTramites}">
                                <!-- Seccion Dereacha Datos de la cita -->
                                <b:row rendered="#{citabean.hasDataTramites}">
                                    <h5><h:outputText value="Resumen cita"></h:outputText></h5>
                                    <br/>
                                    <br/>
                                    <b:column mediumScreen="7" largeScreen="7" smallScreen="12">
                                        <b:inputText readonly="true"
                                                     label="Matricula:"
                                                     labelStyle="width:100px;"
                                                     value="#{citabean.strLocalMatricula}"
                                                     labelColMd="4">
                                            <f:facet name="prepend">
                                                <b:iconAwesome name="tag"></b:iconAwesome>
                                            </f:facet>
                                        </b:inputText>
                                    </b:column>
                                    <b:column  mediumScreen="12" largeScreen="12"  smallScreen="12">
                                        <b:inputText readonly="true"
                                                     label="Nombre Usuario"
                                                     labelStyle="width:100px"
                                                     labelColMd="4"
                                                     value="#{citabean.strLocalNombreUser}">
                                            <f:facet name="prepend">
                                                <b:iconAwesome name="user"></b:iconAwesome>
                                            </f:facet>
                                        </b:inputText>
                                    </b:column>

                                    <b:column  mediumScreen="12" largeScreen="12" smallScreen="12">
                                        <b:inputText readonly="true"
                                                     label="Area:"
                                                     labelStyle="width:100px"
                                                     labelColMd="4"
                                                     value="#{citabean.strLocalArea}">
                                            <f:facet name="prepend">
                                                <b:iconAwesome name="bank"></b:iconAwesome>
                                            </f:facet>
                                        </b:inputText>
                                    </b:column>

                                    <b:column  mediumScreen="12" largeScreen="12" smallScreen="12">
                                        <b:inputText readonly="true"
                                                     label="Tramite:"
                                                     id="Tramite"
                                                     labelColMd="4"
                                                     labelStyle="width:100px"
                                                     value="#{citabean.strLocalTramite}">
                                            <f:facet name="prepend">
                                                <b:iconAwesome name="archive"></b:iconAwesome>
                                            </f:facet>
                                        </b:inputText>
                                    </b:column>

                                    <b:column  mediumScreen="12" largeScreen="12" smallScreen="12">
                                        <b:inputText readonly="true"
                                                     label="Fecha Cita:"
                                                     labelColMd="4"
                                                     id="fechacurrent"
                                                     labelStyle="width:100px"
                                                     value="#{citabean.fechaFormatCita()}">
                                            <f:facet name="prepend">
                                                <b:iconAwesome name="calendar"></b:iconAwesome>
                                            </f:facet>
                                        </b:inputText>
                                    </b:column>

                                    <b:column  mediumScreen="12" largeScreen="12" smallScreen="12">
                                        <b:inputText readonly="true"
                                                     id="combohoras"
                                                     label="Hora Cita:"
                                                     labelColMd="4"
                                                     labelStyle="width:100px"
                                                     value="#{citabean.strCurrentHora}">
                                            <f:facet name="prepend">
                                                <b:iconAwesome name="clock-o"></b:iconAwesome>
                                            </f:facet>
                                        </b:inputText>
                                    </b:column>
                                </b:row>
                                <b:row>
                                  <b:column smallScreen="12" mediumScreen="3" largeScreen="3">
                                      <b:container id="linkgo" rendered="#{citabean.hasDataLink}" style="margin-top:15px;width:300px">
                                          <h5><h:outputText value="Requisitos de tramite:" style="color:#5E0723;font-weight: bold;"></h:outputText></h5>
                                          <b:label severity="primary" style="font-size:10px;margin-top:10px" value="#{msj['comun.label.citas.requisitosLabel']}">
                                          </b:label>
                                          <a href="#{citabean.getLink()}" target="_blank">Ver requisitos</a>
                                      </b:container>
                                  </b:column>
                                </b:row>
                                <br/>
                                <b:container style="margin-top:15px;width:10px">
                                    <b:commandButton styleClass="btn btn-default"
                                                     value="Agendar cita"
                                                     action="#{citabean.agendarCita()}"
                                                     ajax="true">
                                    </b:commandButton>
                                </b:container>
                            </b:column>
                        </b:row>
                    </b:form>
                </b:container>
            </b:panel>
        </b:container>
        <b:modal id="modalCancelar" title="Cancelar Cita" styleClass="modalCancelar">
            <p>Esta a punto de cancelar su cita con el area de <h:outputText value="#{misictas.localArea}"></h:outputText> con el objetivo de  <h:outputText value="#{misictas.localTramite}"></h:outputText> </p>
            <h:form>
                <b:inputText placeholder="Escribe aquí" value="#{misictas.motivoCancelacion}"></b:inputText>

                <b:commandButton title="Cancelar" value="Cancelar" action="#{misictas.Cancelar()}" styleClass="btn btn-default">
                </b:commandButton>
            </h:form>
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" />
                <b:button value="Estoy de acuerdo" look="btn btn-default" dismiss="modal" />
            </f:facet>
        </b:modal>
        <b:modal id="modalWellcome" title="Bienvenido al modulo de citas" styleClass="modal">
            <b:well>
                <h3>Bienvenido al nuevo modulo de citas</h3>
                <p>
                    En este nuevo modulo podras agendar tus citas con las diferentes areas de la univerisad. <br/>
                    <h:outputText value="¿Como se usa?" style="font-weight: bold;"></h:outputText>
                </p>
                <b:carousel id="carrucelitems" startAnimation="false" showIndicators="true" wrap="false">
                    <b:carouselItem>
                        <h:graphicImage library="imagenes" name="citas/selectArea.png" alt="img areas"></h:graphicImage>
                        <b:carouselCaption>
                            <h5>Selecciona el area o departamento el en cual nesitas una cita</h5>
                        </b:carouselCaption>
                    </b:carouselItem>

                    <b:carouselItem>
                        <h:graphicImage library="imagenes" name="citas/selecTramite.png" alt="img areas"></h:graphicImage>
                        <b:carouselCaption>
                            <h5>Selecciona el tramite que vas a realizar</h5>
                        </b:carouselCaption>
                    </b:carouselItem>

                    <b:carouselItem>
                        <h:graphicImage library="imagenes" name="citas/calendar.png" alt="img areas"></h:graphicImage>
                        <b:carouselCaption>
                            <h5>Elige una fecha y da clik en comprobar disponibilidad</h5>
                        </b:carouselCaption>
                    </b:carouselItem>

                    <b:carouselItem>
                        <h:graphicImage library="imagenes" name="citas/selectHora.png" alt="img areas"></h:graphicImage>
                        <b:carouselCaption>
                            <h5>Elige un horario dentro de los disponibles si la lista esta vacias elige otra fecha</h5>
                        </b:carouselCaption>
                    </b:carouselItem>

                    <b:carouselItem>
                        <h:graphicImage library="imagenes" name="citas/resumencita.png" alt="img areas"></h:graphicImage>
                        <b:carouselCaption>
                            <h5>Esto es un resumen de tu cita comprueba que los datos son correctos antes de agendar</h5>
                        </b:carouselCaption>
                    </b:carouselItem>
                </b:carousel>

            </b:well>

            <f:facet name="footer">
                <b:button value="Lo tengo!" look="btn btn-default" dismiss="modal" />
            </f:facet>
        </b:modal>
        <script>
            $(document).ready(function () {
                const showModalCancelarCita = () => $('.modalCancelar').modal();

                const showModalWellcome = () => $('#modalWellcome').modal();

                showModalWellcome();
            });
        </script>
    </ui:define>
</ui:composition>